<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Yuan & Yuan Dish - Python Backend</title>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;600;700&family=Source+Sans+3:wght@400;500;600&display=swap"
    />
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="dish-detail.css" />
    <style>
      .backend-indicator {
        position: fixed;
        top: 10px;
        right: 10px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        z-index: 1000;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      }
      .backend-indicator.api-mode {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      }
      .backend-indicator.error {
        background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
      }
    </style>
  </head>
  <body>
    <div id="backend-indicator" class="backend-indicator">ğŸ”„ Connecting...</div>
    
    <header class="hero">
      <div class="header-content">
        <nav class="top-nav">
          <a class="nav-link active" href="index-backend.html">èœè°±ä¸»é¡µ / Dishes</a>
          <a class="nav-link" href="materials.html">ææ–™ç®¡ç† / Materials</a>
          <a class="nav-link" href="made-dinner.html">å®Œæˆçš„æ™šé¤ / Made Dinners</a>
        </nav>
        <h1>Yuan & Yuan Dish / è¢ä¸è¢å®¶å¸¸èœ</h1>
        <p class="tagline">é€‰èœã€æŸ¥çœ‹æ­¥éª¤ã€ç”Ÿæˆåˆå¹¶è´­ç‰©æ¸…å• / Pick dishes, view steps, and build a combined grocery list.</p>
        <p class="tagline" style="margin-top: 8px; color: #38ef7d; font-weight: 600;">ğŸ Python Backend Mode</p>
      </div>
    </header>

    <main class="container">
      <section class="card">
        <h2>1) é€‰æ‹©èœå“ / Choose a dish</h2>
        <p class="helper">ç‚¹å‡»å›¾ç‰‡æŸ¥çœ‹è¯¦ç»†èœè°± / Click a photo to view detailed recipe.</p>
        <div id="dish-gallery" class="dish-gallery"></div>
      </section>

      <section class="card">
        <h2>2) æ™šé¤è§„åˆ’ / Big dinner plan</h2>
        <div class="dinner-section">
          <h3>å·²é€‰èœå“ / Selected dishes</h3>
          <ul id="selected-dishes" class="chip-list"></ul>
        </div>
        
        <div class="dinner-actions">
          <button id="clear-dinner" type="button">æ¸…ç©ºæ™šé¤ / Clear dinner</button>
        </div>
        
        <div class="grocery-section">
          <h3>åˆå¹¶è´­ç‰©æ¸…å• / Combined grocery list</h3>
          <div id="combined-materials"></div>
        </div>
      </section>

      <footer class="attribution">
        <p>
          ğŸ“¦ Product data powered by <a href="https://world.openfoodfacts.org" target="_blank" rel="noopener">Open Food Facts</a> 
          Â· Licensed under <a href="https://opendatacommons.org/licenses/odbl/1.0/" target="_blank" rel="noopener">ODbL</a>
          Â· ğŸ Python Flask Backend
        </p>
      </footer>
    </main>

    <!-- Dish Detail Modal -->
    <div id="dish-detail-modal" class="dish-detail-modal">
      <div class="dish-detail-content">
        <button class="dish-detail-close" onclick="closeDishDetail()">Ã—</button>
        <div id="dish-detail-body"></div>
      </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast-notification" class="toast-notification">
      <span class="toast-icon">âœ…</span>
      <span class="toast-message"></span>
    </div>

    <!-- Load app files -->
    <script src="app.js"></script>
    <script src="api-client.js"></script>
    
    <script>
      // Override init to use API
      window.addEventListener("DOMContentLoaded", async () => {
        const indicator = document.getElementById('backend-indicator');
        
        try {
          // Check if API is available
          const isHealthy = await checkAPIHealth();
          
          if (isHealthy) {
            indicator.textContent = 'âœ… Python Backend';
            indicator.classList.add('api-mode');
            
            // Initialize with API
            await initWithAPI();
          } else {
            indicator.textContent = 'âŒ Backend Offline';
            indicator.classList.add('error');
            alert('Backend server is not running. Please start the Flask server first.');
          }
        } catch (error) {
          console.error('Initialization error:', error);
          indicator.textContent = 'âŒ Error';
          indicator.classList.add('error');
        }
      });
    </script>
  </body>
</html>
