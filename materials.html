<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Yuan & Yuan Dish - Materials</title>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;600;700&family=Source+Sans+3:wght@400;500;600&display=swap"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <main class="container">
      <header class="hero">
        <nav class="top-nav">
          <a class="nav-link" href="index.html">èœè°±ä¸»é¡µ / Dishes</a>
          <a class="nav-link active" href="materials.html">ææ–™ç®¡ç† / Materials</a>
        </nav>
        <h1>ææ–™ç®¡ç† / Materials</h1>
        <p>ç»Ÿä¸€ç®¡ç†ææ–™ä»·æ ¼ä¸é—¨åº—ä¿¡æ¯ / Manage materials, prices, and store locations.</p>
      </header>

      <section class="card">
        <div class="materials-toolbar">
          <div>
            <h2>ææ–™æ¸…å• / Materials Catalog</h2>
            <p class="helper">æ‰€æœ‰ææ–™å‡ä¸èœè°±å…±äº«åŒä¸€æ•°æ® / Shared data with dish pages.</p>
            <div class="store-legend">
              <span class="legend-item">
                <svg width="24" height="24" style="flex-shrink: 0;">
                  <circle cx="12" cy="12" r="11" fill="#00674f"/>
                  <text x="12" y="16" font-size="10" font-weight="700" fill="white" text-anchor="middle" font-family="Arial, sans-serif">WF</text>
                </svg>
                Whole Foods / å…¨é£Ÿè¶…å¸‚
              </span>
              <span class="legend-item">
                <svg width="24" height="24" style="flex-shrink: 0;">
                  <circle cx="12" cy="12" r="11" fill="#e31837"/>
                  <text x="12" y="17" font-size="12" font-weight="700" fill="white" text-anchor="middle" font-family="Arial, sans-serif">S</text>
                </svg>
                Safeway / è¥¿å¤«éŸ¦
              </span>
              <span class="legend-item">
                <svg width="24" height="24" style="flex-shrink: 0;">
                  <rect width="24" height="24" rx="12" fill="#ff9500"/>
                  <text x="12" y="17" font-size="10" font-weight="700" fill="white" text-anchor="middle" font-family="Arial, sans-serif">99</text>
                </svg>
                Ranch 99 / å¤§åè¶…å¸‚
              </span>
              <span class="legend-item">
                <svg width="24" height="24" style="flex-shrink: 0;">
                  <circle cx="12" cy="12" r="11" fill="#007A87"/>
                  <text x="12" y="17" font-size="10" font-weight="700" fill="white" text-anchor="middle" font-family="Arial, sans-serif">TJ</text>
                </svg>
                Trader Joe's / ä¹”æ°è¶…å¸‚
              </span>
            </div>
          </div>
          <div class="materials-filter">
            <label>é—¨åº— / Store</label>
            <div class="store-buttons" id="store-filter">
              <button class="store-button active" data-store="all">
                <span class="store-button-icon">ğŸª</span>
                <span class="store-button-text">å…¨éƒ¨ / All</span>
              </button>
              <button class="store-button" data-store="Whole Foods">
                <svg width="20" height="20" style="flex-shrink: 0;">
                  <circle cx="10" cy="10" r="9" fill="#00674f"/>
                  <text x="10" y="14" font-size="8" font-weight="700" fill="white" text-anchor="middle">WF</text>
                </svg>
                <span class="store-button-text">Whole Foods</span>
              </button>
              <button class="store-button" data-store="Safeway">
                <svg width="20" height="20" style="flex-shrink: 0;">
                  <circle cx="10" cy="10" r="9" fill="#e31837"/>
                  <text x="10" y="14" font-size="10" font-weight="700" fill="white" text-anchor="middle">S</text>
                </svg>
                <span class="store-button-text">Safeway</span>
              </button>
              <button class="store-button" data-store="Ranch99">
                <svg width="20" height="20" style="flex-shrink: 0;">
                  <rect width="20" height="20" rx="10" fill="#ff9500"/>
                  <text x="10" y="14" font-size="8" font-weight="700" fill="white" text-anchor="middle">99</text>
                </svg>
                <span class="store-button-text">Ranch 99</span>
              </button>
              <button class="store-button" data-store="Trader Joe's">
                <svg width="20" height="20" style="flex-shrink: 0;">
                  <circle cx="10" cy="10" r="9" fill="#007A87"/>
                  <text x="10" y="14" font-size="8" font-weight="700" fill="white" text-anchor="middle">TJ</text>
                </svg>
                <span class="store-button-text">Trader Joe's</span>
              </button>
            </div>
          </div>
        </div>
        <div id="materials-grid" class="materials-grid"></div>
      </section>

      <footer class="attribution">
        <p>
          ğŸ“¦ Product data powered by <a href="https://world.openfoodfacts.org" target="_blank" rel="noopener">Open Food Facts</a> 
          Â· Licensed under <a href="https://opendatacommons.org/licenses/odbl/1.0/" target="_blank" rel="noopener">ODbL</a>
          Â· A free and open database of food products from around the world
        </p>
      </footer>
    </main>

    <script>
      // Pre-check before loading
      console.log('Page loaded, about to load scripts from store databases');
      window.addEventListener('error', function(e) {
        console.error('Global error:', e.error, e.message, e.filename, e.lineno);
        const grid = document.getElementById('materials-grid');
        if (grid && grid.innerHTML.trim() === '') {
          grid.innerHTML = '<p style="color: red;">é”™è¯¯ï¼š' + e.message + '<br/>Error: ' + e.message + '</p>';
        }
      });
    </script>
    <!-- Load store data files (simulating 4 separate database tables) -->
    <script src="wholefoods-data.js"></script>
    <script src="safeway-data.js"></script>
    <script src="ranch99-data.js"></script>
    <script src="traderjoes-data.js"></script>
    <script src="data.js"></script>
    <script>
      // Merge materials from all stores into main DATA object
      if (typeof WHOLEFOODS_MATERIALS !== 'undefined' && window.DATA) {
        window.DATA.MATERIALS = [
          ...WHOLEFOODS_MATERIALS,
          ...SAFEWAY_MATERIALS,
          ...RANCH99_MATERIALS,
          ...TRADERJOES_MATERIALS
        ];
        console.log('âœ“ Loaded materials from 4 store databases:', window.DATA.MATERIALS.length);
      }
      
      // Validate data load
      if (!window.DATA || !window.DATA.MATERIALS || window.DATA.MATERIALS.length === 0) {
        console.error('DATA not loaded correctly!');
        document.getElementById('materials-grid').innerHTML = 
          '<p style="color: red;">æ•°æ®åŠ è½½å¤±è´¥ / Data failed to load. Check console for errors.</p>';
      }
    </script>
    <script src="materials.js"></script>
  </body>
</html>
